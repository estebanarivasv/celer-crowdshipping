<p-toast></p-toast>
<div class="grid p-fluid">
    <div class="flex items-center mt-3">
        <div class="justify-content-start mr-5">
            <button routerLink="/sender" pButton pRipple type="button" icon="pi pi-arrow-left"
                    class="p-button-rounded p-button-outlined p-button-secondary"></button>
        </div>
        <h3 class="my-3 text-xl font-bold ">Shipping details</h3>
    </div>

    <div class="p-card p-component pt-0 mt-0 m-2">
        <div class="p-card-content pt-0 mt-0 m-2">
            <div class="flex flex-col sm:flex-row justify-between items-start">
                <div class="sm:w-2/3 mb-2">
                    <p class="text-xl font-bold my-2">{{ shipping!.package.name }}</p>
                    <p class="py-1"><strong>Description: </strong> {{ shipping!.package.description }}</p>
                    <p class="py-1"><strong>Value: </strong> $ {{ shipping!.package.value }}</p>
                    <p class="py-1"><strong>Size: </strong> {{ shipping!.package.dimensions }}</p>
                </div>
                <div class="sm:w-1/3 mb-2">
                    <p class="text-xl font-bold my-2">Tracking</p>
                    <ng-template [ngIf]="!shippingCompleted!">
                        <div class="p-card-content -mt-4 p-0">
                            <p><strong>Shipping state:</strong>
                                <p-chip styleClass="ml-1"
                                        label="{{shippingState!.childActivityInstances![0].activityId}}"></p-chip>

                            </p>

                            <p class="my-2">Activity name:
                                <u class="ml-2">{{ shippingState!.childActivityInstances![0].activityName }}</u></p>
                            <p class="ml-1">
                                <strong></strong>
                            </p>
                            <div class="flex"></div>
                            <ng-template
                                    [ngIf]="shippingState!.childActivityInstances![0].activityId! == 'ConfirmPackageOkTask'">
                                <div class="flex">
                                    <button (click)="onClickPkgOk(shipping!.id!)"
                                            pButton pRipple type="button" label="Package OK"
                                            class="p-button-outlined p-button-rounded p-button-success w-4"></button>
                                </div>
                            </ng-template>
                        </div>
                    </ng-template>
                    <ng-template [ngIf]="shippingCompleted!">
                        <div class="p-card-content -mt-4 p-0">
                            <p>Shipping state:
                                <p-chip styleClass="ml-2"
                                        label="Completed"></p-chip>
                            </p>
                        </div>
                    </ng-template>
                </div>
            </div>

            <div class="flex flex-col sm:flex-row justify-between items-start">
                <div class="sm:w-1/3 mb-2">
                    <h4 class="text-xl font-bold my-2">Origin</h4>
                    <p class="py-1"><strong>From:</strong>
                        <p-chip label="{{shipping!.originAddress}}"></p-chip>
                    </p>
                    <p class="py-1"><strong>Sender:</strong>
                        {{ shipping!.sender!.firstName }} {{ shipping!.sender!.lastName }}</p>
                    <p class="my-2"><strong>Mobile: </strong>{{ shipping!.sender!.phone }}</p>
                    <p class="my-2"><strong>Username: </strong>{{ shipping!.sender!.username }}</p>
                </div>
                <div class="sm:w-1/3 mb-2">
                    <h4 class="text-xl font-bold">Destination</h4>
                    <p class="py-1"><strong>To:</strong>
                        <p-chip label="{{shipping!.destinationAddress}}"></p-chip>
                    </p>
                    <p class="py-1"><strong>Recipient:</strong>
                        {{ shipping!.recipient!.firstName }} {{ shipping!.recipient!.lastName }}</p>
                </div>
                <div class="sm:w-1/3 mb-2">
                    <ng-template [ngIf]="!shipping!.selectedOfferId">
                        <ng-template [ngIf]="offers">
                            <h4 class="text-xl font-bold">Offers</h4>
                            <p-scrollPanel [style]="{width: '100%', height: '200px'}" styleClass="">
                                <div *ngFor="let offer of offers" class="p-card p-3">
                                    <div class="flex justify-between items-start mt-3">
                                        <div class="sm:w-2/3">
                                            <p><strong>$ {{ offer.shippingCost }} - arrives
                                                in {{ offer.duration }}
                                                hours</strong></p>
                                            <p>Message: {{ offer.message }}</p>
                                        </div>
                                        <div class="sm:w-1/3 flex items-center justify-end">
                                            <div class="flex w-min">
                                                <button (click)="markOfferAsSelected(shipping!.id!, offer!.id!)"
                                                        pButton
                                                        pRipple type="button"
                                                        label="Accept"
                                                        class="p-button-rounded p-button-success p-button-sm"></button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </p-scrollPanel>
                        </ng-template>
                    </ng-template>
                    <ng-template [ngIf]="shipping!.selectedOfferId">
                        <h4 class="text-xl font-bold">Selected Offer</h4>
                        <div class="p-card-content -mt-4 p-0">
                            <p><u>Shipping cost:</u> ${{ selectedOffer!.shippingCost }}</p>
                            <p><u>ETA:</u> {{ selectedOffer!.duration }} hours</p>
                            <p>
                                <u>Distributor:</u> {{ selectedOffer!.distributor!.firstName }} {{ selectedOffer!.distributor!.lastName }}
                            </p>
                            <p class="ml-4 -mt-2 ">
                                <strong>Mobile: </strong>{{ selectedOffer!.distributor!.phone }} -
                                <strong>Username: </strong>{{ selectedOffer!.distributor!.username }}
                            </p>
                        </div>
                    </ng-template>
                </div>
            </div>
        </div>
    </div>
</div>